## 需求分析

用户提出了两个核心需求：

1. **全量缓存和预加载**：确保所有数据操作都基于完整的数据集，避免处理逻辑出现问题
2. **每日一字和随机序列**：
   - 字卡显示需要组成随机序列
   - 每天显示的第一个字的ID为：当天距离当年1月1日的天数+1
   - 如果因为难度设置导致序列中无此ID，则随机选择

## 解决方案

### 1. 确保全量缓存和预加载

**现状分析**：
- 当前 `preloadData()` 方法已经获取所有数据
- 缓存机制也保存完整数据

**优化点**：
- 确保所有数据方法都使用 `preloadData()` 获取全量数据
- 增强数据验证和错误处理

### 2. 实现每日一字和随机序列

**需要添加的功能**：

1. **生成随机序列**：
   - 添加 `generateRandomSequence()` 方法
   - 支持基于难度过滤的随机序列生成

2. **计算每日首字ID**：
   - 添加 `getDayOfYear()` 方法计算当天是当年的第几天
   - 每日首字ID = 天数 + 1

3. **获取每日一字**：
   - 添加 `getDailyCharacter()` 方法
   - 首先尝试获取指定ID的字
   - 如果不存在或不符合难度要求，随机选择

4. **获取随机序列**：
   - 添加 `getRandomSequence()` 方法
   - 确保序列中包含每日一字（如果存在）

### 3. 具体修改内容

**修改 `cloudDataService.js`**：

1. **添加辅助方法**：
   - `getDayOfYear()`：计算当天是当年的第几天
   - `shuffleArray()`：随机打乱数组

2. **添加核心功能方法**：
   - `generateRandomSequence()`：生成随机序列
   - `getDailyCharacter()`：获取每日一字
   - `getRandomSequence()`：获取包含每日一字的随机序列

3. **优化现有方法**：
   - 确保所有数据操作都基于全量数据
   - 增强错误处理和边界情况处理

### 4. 实现逻辑

**每日一字逻辑**：
1. 计算当天距离1月1日的天数 + 1 作为目标ID
2. 检查是否存在该ID的汉字
3. 如果存在且符合难度要求，返回该汉字
4. 如果不存在或不符合要求，随机选择一个

**随机序列逻辑**：
1. 生成完整的随机序列
2. 如果每日一字存在且在序列中，确保它在序列开头
3. 如果每日一字不存在，返回纯随机序列

## 预期结果

- ✅ 系统始终使用全量数据进行处理
- ✅ 每天进入小程序时首先显示当日的每日一字
- ✅ 字卡显示按随机序列排列
- ✅ 当每日一字不存在时，系统会自动随机选择
- ✅ 所有功能正常运行，无数据处理逻辑错误