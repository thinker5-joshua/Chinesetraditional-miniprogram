# 中文排版首行退两格实现方案

## 1. 需求分析
- 在生成的菜根谭摘录卡片中，为名言内容添加中文排版首行退两格效果
- 保持现有排版风格和美观度
- 确保在各种长度的名言内容下都能正确显示

## 2. 实现思路
- 为名言内容的第一行添加两个空格的缩进
- 使用Canvas API测量两个空格的宽度，确保缩进精确
- 调整第一行文本的绘制位置，实现首行退两格效果
- 保持其他行的正常对齐

## 3. 技术实现

### 3.1 修改generateShareImage方法中的名言内容绘制逻辑
```javascript
// 绘制名言内容（自动换行，首行退两格）
ctx.fillStyle = '#333333';
ctx.font = '42px sans-serif';
ctx.textAlign = 'left';

const content = quote.quote;
const lineHeight = 70;
const maxWidth = 650;
let startY = 320; // 加大间距
let currentLine = '';
let isFirstLine = true;

// 测量两个空格的宽度，用于首行缩进
const indentWidth = ctx.measureText('  ').width;

for (let i = 0; i < content.length; i++) {
  const testLine = currentLine + content[i];
  const metrics = ctx.measureText(testLine);
  
  // 计算当前行的实际最大宽度（首行需要考虑缩进）
  const currentMaxWidth = isFirstLine ? maxWidth - indentWidth : maxWidth;
  
  if (metrics.width > currentMaxWidth && i > 0) {
    // 绘制当前行
    if (isFirstLine) {
      // 首行添加缩进
      ctx.fillText(`  ${currentLine}`, (canvasWidth - maxWidth) / 2, startY);
      isFirstLine = false;
    } else {
      // 其他行正常绘制
      ctx.fillText(currentLine, (canvasWidth - maxWidth) / 2, startY);
    }
    startY += lineHeight;
    currentLine = content[i];
  } else {
    currentLine = testLine;
  }
}

// 绘制最后一行
if (isFirstLine) {
  // 只有一行时，首行添加缩进
  ctx.fillText(`  ${currentLine}`, (canvasWidth - maxWidth) / 2, startY);
} else {
  // 多行时，最后一行正常绘制
  ctx.fillText(currentLine, (canvasWidth - maxWidth) / 2, startY);
}
startY += lineHeight * 2;
```

## 4. 实现步骤

### 4.1 修改index.js文件
- 定位到generateShareImage方法中的名言内容绘制部分
- 添加首行缩进的逻辑
- 测量两个空格的宽度
- 调整第一行的绘制位置

### 4.2 测试验证
- 测试不同长度的名言内容，确保首行缩进正确
- 测试多行文本的排版效果
- 确保整体美观度不受影响

## 5. 预期效果
- 名言内容的第一行自动缩进两个字符
- 保持现有排版的美观度和可读性
- 适应不同长度的名言内容
- 符合中文排版规范

## 6. 注意事项
- 确保两个空格的宽度测量准确
- 处理好单行文本和多行文本的情况
- 保持与现有代码的兼容性
- 确保生成的图片质量不受影响