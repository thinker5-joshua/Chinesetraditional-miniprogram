# "守护神兽"小程序功能调整方案（最终版）

## 一、项目概述

### 1.1 功能定位
- 基于中国传统古建筑脊兽文化，开发一款具有文化传播和互动分享功能的小程序模块
- 核心功能：守护神兽抽取、海报生成与分享
- 辅助功能：古建筑脊兽知识库
- 入口位置：在现有tabBar中新增"琢器轩"标签，位于"益游阁"和"关于"之间

### 1.2 文化背景
- 中国古建筑脊兽是传统礼制的重要符号，代表着等级制度和守护寓意
- 完整序列：仙人（领队）→ 龙 → 凤 → 狮子 → 天马 → 海马 → 狻猊 → 狎鱼 → 獬豸 → 斗牛 → 行什
- 每个脊兽都有独特的文化内涵、性格特征和守护能力

## 二、页面结构设计

### 2.1 整体架构
```
├── 首页（益游阁）
├── 琢器轩（新增tab，顶级目录）
│   └── 首页
├── subgames/
│   ├── guardian-beast/（守护神兽，与其他游戏同级）
│   │   ├── 抽取仪式页
│   │   ├── 抽取结果页
│   │   ├── 海报生成页
│   │   └── 分享确认页
│   ├── 成语消除
│   ├── 五行奥秘
│   └── 六十四卦学习
└── 关于页

└── 脊兽知识库
    ├── 脊兽列表页
    └── 脊兽详情页
```

### 2.2 核心页面设计

#### 2.2.1 琢器轩首页
- 页面标题：琢器轩
- 功能入口：仅展示"守护神兽"一个功能入口
- 设计风格：与现有子游戏入口保持一致，使用卡片式布局
- 卡片内容：包含"守护神兽"图标、名称和简短描述
- 跳转路径：点击后跳转到 `subgames/guardian-beast/index`

#### 2.2.2 守护神兽首页
- 页面标题：守护神兽
- 功能入口：
  - 开始抽取
  - 脊兽知识库
- 设计风格：传统与现代结合，使用古建筑元素和现代UI设计

#### 2.2.3 抽取仪式页
- 页面标题：灵契启阵
- 核心内容：
  - 仪式引导文案
  - 3秒倒计时动画
  - 脊兽殿顶背景图（使用云存储的图片）
  - 抽取按钮
- 交互设计：
  - 点击开始按钮后，显示3秒倒计时
  - 倒计时结束后，播放召唤动画
  - 随机抽取守护神兽

#### 2.2.4 抽取结果页
- 页面标题：你的守护神兽
- 核心内容：
  - 守护神兽形象（使用云存储的图片）
  - 神兽名称、拼音、排位
  - 专属箴言
  - 契主特质
  - 守护能力
- 功能按钮：
  - 生成海报
  - 查看详情
  - 重新抽取

#### 2.2.5 海报生成页
- 页面标题：生成分享海报
- 核心内容：
  - 海报预览
  - 海报定制选项（可选）
- 功能按钮：
  - 保存到相册
  - 分享给好友
  - 分享到朋友圈

#### 2.2.6 脊兽列表页
- 页面标题：脊兽图鉴
- 核心内容：
  - 完整脊兽序列列表
  - 每个脊兽的缩略图和名称
- 交互设计：
  - 点击脊兽卡片进入详情页
  - 支持按等级排序

#### 2.2.7 脊兽详情页
- 页面标题：[脊兽名称]详情
- 核心内容：
  - 脊兽形象大图（使用云存储的图片）
  - 基础信息（名称、拼音、排位）
  - 起源故事
  - 寓意象征
  - 性格特征
  - 守护能力
  - 契主特质
  - 相关箴言

## 三、数据结构设计

### 3.1 数据存储方案
- 使用JSON文件存储脊兽数据和箴言数据
- 数据文件放置在小程序本地，减少网络请求
- 图形资源使用微信云开发的云存储，引用方式采用**FileID**

### 3.2 脊兽数据结构（JSON文件）
```json
[
  {
    "id": "xianren",
    "name": "仙人",
    "pinyin": "xiān rén",
    "rank": "0",
    "position": "领队",
    "leader": true,
    "imageFileID": "cloud://env-id/tradEngage/xianren.png",
    "originStory": "仙人指路的典故源于战国时期的传说...",
    "meaning": "引领方向，化险为夷",
    "personality": "智慧通达，慈悲为怀",
    "guardianAbility": "指引方向，化解危机",
    "soulmateTraits": "常感迷茫却总在关键时刻被直觉所救之人",
    "proverbs": [
      "仙人指路，迷途知返",
      "山重水复疑无路，柳暗花明又一村"
    ]
  },
  {
    "id": "long",
    "name": "龙",
    "pinyin": "lóng",
    "rank": "1",
    "position": "第一名",
    "leader": false,
    "imageFileID": "cloud://env-id/tradEngage/dragon.png",
    "originStory": "龙是中国古代神话中的神异动物，为百鳞之长...",
    "meaning": "象征皇权、尊贵和祥瑞",
    "personality": "威严庄重，具有领导力",
    "guardianAbility": "守护皇权，带来祥瑞",
    "soulmateTraits": "具有领导才能，追求卓越的人",
    "proverbs": [
      "龙行天下，自强不息",
      "潜龙勿用，亢龙有悔"
    ]
  }
  // 其他脊兽数据...
]
```

### 3.3 箴言数据结构（JSON文件）
```json
[
  {
    "id": "proverb_001",
    "content": "明辨是非，守护正义",
    "type": "wisdom",
    "relatedBeast": "xiezhi",
    "category": "justice"
  },
  {
    "id": "proverb_002",
    "content": "内心强大，安然自若",
    "type": "guardian",
    "relatedBeast": "suanni",
    "category": "strength"
  }
  // 其他箴言数据...
]
```

## 四、功能实现流程

### 4.1 守护神兽抽取流程
1. 用户进入"琢器轩"首页，点击"守护神兽"入口
2. 进入守护神兽首页，点击"开始抽取"按钮
3. 进入抽取仪式页，阅读引导文案
4. 点击"开始抽取"按钮，显示3秒倒计时动画
5. 调用随机抽取算法，从本地JSON文件的脊兽列表中随机选择一个
6. 播放召唤动画，显示抽取结果
7. 根据抽取的神兽，从JSON文件中获取相关信息和箴言
8. 展示完整的守护神兽信息

### 4.2 海报生成流程
1. 用户在抽取结果页点击"生成海报"按钮
2. 进入海报生成页，加载海报模板
3. 动态填充内容：
   - 守护神兽形象（使用云存储FileID直接引用）
   - 神兽名称和拼音
   - 专属箴言
   - 契主特质
   - 当日农历日期
   - 小程序二维码
4. 用户可以选择保存到相册或分享
5. 调用微信API生成海报并完成分享

### 4.3 知识库浏览流程
1. 用户在守护神兽首页点击"脊兽知识库"或从抽取结果页点击"查看详情"
2. 进入脊兽列表页，查看完整脊兽序列
3. 点击任意脊兽卡片，进入详情页
4. 浏览脊兽的详细信息，包括起源故事、寓意、性格等
5. 支持返回列表或分享详情

## 五、技术实现要点

### 5.1 页面结构实现

#### 5.1.1 更新app.json配置
- 在tabBar的list数组中新增"琢器轩"标签，位于"益游阁"和"关于"之间
- 设置pagePath为"zhuoqixuan/index"
- 图标使用"守"字
- 在pages数组中添加新页面路径

```json
{
  "pages": [
    "pages/index/index",
    "pages/game/game",
    "pages/about/about",
    "subgames/64Hexagrams/pages/hexagram-list/hexagram-list",
    "subgames/64Hexagrams/pages/hexagram-detail/hexagram-detail",
    "subgames/future/index",
    "subgames/64Hexagrams/index",
    "subgames/28Stars/index",
    "subgames/28Stars/pages/constellation-map/constellation-map",
    "subgames/28Stars/pages/star-matching/star-matching",
    "subgames/72DreamlandPoetryTravel/index",
    "subgames/family/index",
    "subgames/VegetableRootSayings/index",
    "subgames/WuxingMysteries/index",
    "subgames/WuxingMysteries/pages/main/index",
    "subgames/WuxingMysteries/pages/wuxing/index",
    "subgames/WuxingMysteries/pages/wufang/index",
    "subgames/WuxingMysteries/pages/wuse/index",
    "subgames/WuxingMysteries/pages/wuzang/index",
    "subgames/WuxingMysteries/pages/detail/detail",
    "zhuoqixuan/index",
    "subgames/guardian-beast/index",
    "subgames/guardian-beast/draw",
    "subgames/guardian-beast/result",
    "subgames/guardian-beast/poster",
    "subgames/guardian-beast/knowledge/list",
    "subgames/guardian-beast/knowledge/detail"
  ],
  "tabBar": {
    "color": "#666666",
    "selectedColor": "#8B4513",
    "backgroundColor": "#ffffff",
    "borderStyle": "black",
    "list": [
      {
        "pagePath": "pages/index/index",
        "text": "益游阁"
      },
      {
        "pagePath": "zhuoqixuan/index",
        "text": "琢器轩",
        "iconPath": "images/shou.png",
        "selectedIconPath": "images/shou-active.png"
      },
      {
        "pagePath": "pages/about/about",
        "text": "关于"
      }
    ]
  }
}
```

#### 5.1.2 创建页面文件结构
```
├── pages/
├── subgames/
│   ├── 64Hexagrams/
│   ├── 28Stars/
│   ├── 72DreamlandPoetryTravel/
│   ├── WuxingMysteries/
│   ├── future/（成语消除）
│   ├── family/
│   ├── VegetableRootSayings/
│   └── guardian-beast/（守护神兽）
│       ├── index.js
│       ├── index.json
│       ├── index.wxml
│       ├── index.wxss
│       ├── draw.js
│       ├── draw.json
│       ├── draw.wxml
│       ├── draw.wxss
│       ├── result.js
│       ├── result.json
│       ├── result.wxml
│       ├── result.wxss
│       ├── poster.js
│       ├── poster.json
│       ├── poster.wxml
│       ├── poster.wxss
│       ├── knowledge/
│       │   ├── list.js
│       │   ├── list.json
│       │   ├── list.wxml
│       │   ├── list.wxss
│       │   ├── detail.js
│       │   ├── detail.json
│       │   ├── detail.wxml
│       │   └── detail.wxss
│       └── data/
│           ├── beasts.json
│           └── proverbs.json
├── zhuoqixuan/（新增顶级目录）
│   ├── index.js
│   ├── index.json
│   ├── index.wxml
│   └── index.wxss
├── images/
└── app.json
```

### 5.2 数据管理

#### 5.2.1 本地JSON数据加载
- 在需要使用数据的页面，通过require函数加载本地JSON文件
- 示例：
  ```javascript
  const beastsData = require('./data/beasts.json');
  const proverbsData = require('./data/proverbs.json');
  ```

#### 5.2.2 随机抽取算法
- 使用微信小程序内置的Math.random()方法
- 确保每个脊兽被抽取的概率相等
- 实现简单高效，不需要复杂的算法

```javascript
function randomBeast() {
  const beasts = require('./data/beasts.json');
  const randomIndex = Math.floor(Math.random() * beasts.length);
  return beasts[randomIndex];
}
```

### 5.3 图形资源管理

#### 5.3.1 云存储图片引用方式
- **使用FileID而非URL**：在微信小程序中，云存储的图片应使用FileID引用，格式为 `cloud://env-id/filepath`
- **FileID的优势**：
  - 永久有效，不会过期
  - 微信小程序的`<image>`组件原生支持FileID，可直接使用 `src="cloud://env-id/filename"`
  - 无需额外调用API生成临时URL
  - 加载效率更高

#### 5.3.2 图片使用示例
```wxml
<!-- 直接在image组件中使用FileID -->
<image src="cloud://env-id/tradEngage/dragon.png" mode="aspectFit"></image>
```

#### 5.3.3 海报生成中的图片处理
- 在使用Canvas绘制海报时，需要先将FileID转换为临时文件路径
- 使用 `wx.cloud.downloadFile()` API获取临时文件路径，然后绘制到Canvas上

```javascript
// 下载云存储图片到本地临时路径
wx.cloud.downloadFile({
  fileID: beast.imageFileID,
  success: res => {
    // res.tempFilePath 为临时文件路径
    const tempFilePath = res.tempFilePath;
    // 使用Canvas绘制图片
    ctx.drawImage(tempFilePath, x, y, width, height);
  }
});
```

### 5.4 海报生成技术
- 使用Canvas绘制动态海报
- 支持自定义字体和颜色
- 适配不同屏幕尺寸
- 调用微信API保存到相册或分享

## 六、文化内容整理建议

### 6.1 脊兽序列完整度
- 确保包含完整的脊兽序列：仙人（领队）→ 龙 → 凤 → 狮子 → 天马 → 海马 → 狻猊 → 狎鱼 → 獬豸 → 斗牛 → 行什
- 每个脊兽的信息要准确，来源可靠

### 6.2 性格特征与契主特质设计
- 结合现代心理学理论，设计符合当代年轻人认知的性格描述
- 契主特质要具有共鸣感，避免过于抽象
- 保持传统文化内涵的同时，增强现代传播性

### 6.3 箴言内容设计
- 结合脊兽的寓意和性格，设计有启发性的箴言
- 可以引用经典古籍中的名言警句
- 也可以原创符合当代价值观的箴言

## 七、项目实施计划

### 7.1 第一阶段：基础架构搭建
- 更新app.json配置，添加"琢器轩"tab和新页面路径
- 创建所有页面文件和目录结构（按照新的目录结构）
- 准备本地JSON数据文件，填充脊兽和箴言数据

### 7.2 第二阶段：核心功能实现
- 实现守护神兽首页和抽取仪式页
- 开发随机抽取算法和结果展示页
- 实现海报生成和分享功能

### 7.3 第三阶段：知识库功能实现
- 实现脊兽列表页
- 开发脊兽详情页
- 添加知识内容和交互功能

### 7.4 第四阶段：UI设计与优化
- 设计统一的视觉风格，与现有子游戏保持一致
- 添加动画效果，优化用户体验
- 确保响应式设计，适配不同设备

### 7.5 第五阶段：测试与上线
- 功能测试和兼容性测试
- 性能优化
- 提交审核，上线发布

## 八、预期效果

### 8.1 文化传播效果
- 让更多年轻人了解中国传统古建筑脊兽文化
- 通过互动体验增强文化认同感
- 促进传统文化的现代传播

### 8.2 用户体验效果
- 流畅的动画效果，增强互动体验
- 精美的海报设计，提高分享意愿
- 丰富的文化内容，增加用户粘性

### 8.3 社交传播效果
- 用户主动分享守护神兽海报
- 形成话题讨论，扩大影响力
- 吸引更多新用户关注

## 九、后续扩展建议

### 9.1 功能扩展
- 添加脊兽知识问答游戏
- 实现守护神兽成长系统
- 开发脊兽AR互动功能

### 9.2 内容扩展
- 增加更多古建筑文化内容
- 扩展到其他传统建筑元素
- 定期更新JSON数据，添加新的故事和箴言

### 9.3 社交扩展
- 添加好友互动功能
- 开发守护神兽配对系统
- 举办脊兽文化主题活动

## 十、总结

"守护神兽"功能将中国传统古建筑脊兽文化与现代小程序技术相结合，通过互动体验和社交分享，实现了传统文化的创新传播。

本方案按照用户要求调整了目录结构，将"zhuoqixuan"作为顶级目录，"guardian-beast"移至"subgames"下与其他游戏同级，便于后续管理和调整。同时明确了使用FileID引用云存储图片的技术方案，确保了技术实现的正确性和高效性。

通过本方案的实施，预期将达到良好的文化传播效果和用户体验效果，为传统文化的现代传承做出贡献。