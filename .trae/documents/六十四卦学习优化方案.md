# 六十四卦学习优化方案

## 一、核心调整思路
1. **首页功能重构**：将当前`subgames/64Hexagrams/index.js`的配对功能迁移到新页面，将卦象列表学习功能移至首页
2. **按钮功能调整**：首页添加"存卡片"和"去识卦"两个按钮
3. **存卡片功能实现**：使用canvas2D API生成包含卦象、爻辞和小程序码的卡片并保存到相册，包含卦列表页显示的所有内容
4. **页面结构调整**：移除不必要的返回按钮，添加相应说明文字

## 二、详细实现方案

### 1. 页面结构调整
- **首页**：`subgames/64Hexagrams/index.js`
  - 替换为卦象列表学习功能（当前`hexagram-list`页面的功能）
  - 移除配对游戏相关代码
  - 添加"存卡片"和"去识卦"按钮

- **新页面**：创建`subgames/64Hexagrams/pages/matching/matching.js`
  - 迁移当前首页的配对游戏功能
  - 添加返回按钮

- **卦象列表页**：保持`hexagram-list`页面不变，作为备选入口

### 2. 首页功能实现
- **引入卦象数据**：保持原有数据引入
- **实现卦象列表逻辑**：
  - 复制`hexagram-list.js`的核心逻辑到首页
  - 支持随机翻阅、分组查看、六爻变三种模式
  - 保留上一个、下一个卦象切换功能

### 3. 按钮功能调整
- **存卡片按钮**：
  - 位置：首页顶部
  - 功能：使用canvas2D API生成当前卦象卡片
  - 生成内容：卦象序号 + 卦象符号 + 卦名 + 拼音 + 别名 + 上下卦 + 卦辞 + 爻辞 + 下部小程序名称和小程序码
  - 保存到相册功能

- **去识卦按钮**：
  - 位置：首页顶部
  - 功能：跳转到新创建的配对游戏页面

### 4. 存卡片功能实现
- **Canvas绘制逻辑**：
  - 参考菜根谭摘录的保存卡片功能
  - 适配六十四卦内容格式
  - 小程序码使用提供的file id

- **生成内容结构**：
  - 顶部：卦象序号（第X卦）
  - 上中部：卦象符号（大号字体）
  - 中上部：卦名 + 拼音
  - 中部：别名 + 上下卦
  - 中下部：卦辞（自动换行）
  - 下部：爻辞（自动换行）
  - 底部：小程序名称说明 + 小程序码

- **保存到相册**：
  - 调用wx.canvasToTempFilePath生成临时文件
  - 调用wx.saveImageToPhotosAlbum保存到相册
  - 处理授权逻辑

### 5. 页面细节调整
- **六十四卦学习页面**：
  - 移除返回按钮
  - 在上一个、下一个按钮下方添加"点击卡片查看卦详情"说明文字
  - 优化页面布局

- **配对游戏页面**：
  - 添加返回按钮，返回首页
  - 保持原有配对游戏功能不变

### 6. 其他同步调整
- **导航逻辑调整**：
  - 首页"去识卦"跳转到配对页面
  - 配对页面返回按钮返回首页
  - 卦详情页返回逻辑调整

- **分享功能调整**：
  - 更新分享路径和标题
  - 确保分享功能正常

- **测试场景**：
  - 从首页进入配对页面
  - 从配对页面返回首页
  - 存卡片功能正常工作，包含所有要求内容
  - 各种查看模式切换正常
  - 卦详情页跳转正常

## 三、文件修改列表
1. **首页重构**：`subgames/64Hexagrams/index.js`、`index.wxml`、`index.wxss`
2. **新页面创建**：`subgames/64Hexagrams/pages/matching/matching.js`、`matching.wxml`、`matching.wxss`
3. **卦象列表页调整**：`subgames/64Hexagrams/pages/hexagram-list/hexagram-list.js`（移除返回按钮）
4. **卦详情页调整**：`subgames/64Hexagrams/pages/hexagram-detail/hexagram-detail.js`
5. **相关配置文件调整**：`app.json`添加新页面

## 四、实现步骤
1. 创建新的配对游戏页面，迁移现有配对功能
2. 重构首页，替换为卦象列表学习功能
3. 在首页添加"存卡片"和"去识卦"按钮
4. 实现存卡片功能，包含所有要求的卦象信息
5. 调整页面细节，添加说明文字，移除不必要的返回按钮
6. 测试所有功能，确保正常工作

## 五、技术要点
1. Canvas2D API的使用，确保生成清晰美观的卡片，包含所有卦象信息
2. 页面结构调整，确保功能逻辑清晰
3. 导航逻辑优化，确保页面跳转正常
4. 授权处理，确保保存到相册功能正常
5. 小程序码的加载和绘制

## 六、预期效果
1. 首页直接展示六十四卦学习功能，用户可以方便地浏览和学习
2. 存卡片功能生成包含完整卦象信息的卡片，方便用户保存和分享
3. 去识卦按钮提供配对游戏入口，增加学习趣味性
4. 页面布局清晰，用户体验流畅
5. 各种功能正常工作，无明显bug