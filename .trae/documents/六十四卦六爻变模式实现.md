## 六十四卦六爻变模式优化实现

### 功能需求
1. 增加六爻变模式，形成三种模式：随机翻、六爻变、分组看
2. 六爻变模式显示随机卦象，下方有6个爻按钮，可切换阴阳状态
3. 按钮点击时卦象随之变化，保持左右滑动换页支持
4. 严格遵循周易爻位命名规则：
   - 爻位顺序：从下往上数，最底为"初爻"，最上为"上爻"
   - 阴爻命名：初六、六二、六三、六四、六五、上六
   - 阳爻命名：初九、九二、九三、九四、九五、上九
   - 符号：阴爻⚋（U+268B），阳爻⚊（U+268A）

### 实现思路
1. 扩展viewMode类型，增加'sixYaoChange'选项
2. 设计符合周易规则的六爻UI，包括卦象显示和6个爻按钮
3. 实现六爻状态与卦象的映射关系
4. 实现按钮点击事件，切换阴阳状态并更新卦象
5. 保持滑动换页功能，同步更新六爻状态

### 实现步骤

#### 1. 扩展数据结构
- 在data中添加六爻变相关字段：
  - currentSixYaoHexagram：当前显示的卦象
  - sixYaoStates：六爻阴阳状态数组（0:阴，1:阳，从下往上）
  - sixYaoButtons：六爻按钮配置数组

#### 2. 实现模式切换UI
- 修改模式选择按钮，增加"六爻变"选项
- 调整按钮布局，确保三个模式按钮能清晰显示

#### 3. 设计六爻变UI
- 创建六爻变模式的视图容器
- 显示随机卦象卡片，与随机翻模式保持一致
- 设计6个爻按钮，采用横排布局：
  - 每个按钮显示两行：上方是爻位名称（如"初六"），下方是阴阳符号（如"⚋"）
  - 按钮按爻位顺序排列，从左到右对应初爻到上爻
  - 按钮样式区分阴阳状态

#### 4. 实现六爻状态与卦象的映射
- 分析hexagramsData中卦象的symbol属性，提取六爻信息
- 创建映射表，将六爻状态数组映射到对应的卦象
- 实现转换函数：根据六个爻的阴阳状态找到对应的卦象

#### 5. 实现按钮点击逻辑
- 点击按钮时，切换对应爻的阴阳状态
- 根据新的六爻状态计算并更新卦象
- 同步更新按钮的显示内容和样式

#### 6. 保持滑动换页功能
- 为六爻变模式添加左右滑动支持
- 滑动换页时，根据新卦象更新六爻按钮状态
- 实现六爻状态的自动计算：根据卦象symbol提取六爻信息

### 关键代码实现

#### 1. 数据结构扩展
```javascript
data: {
  // ... 现有数据 ...
  // 六爻变相关
  currentSixYaoHexagram: null,
  sixYaoStates: [0, 0, 0, 0, 0, 0], // 从下往上，0:阴，1:阳
  sixYaoButtons: [], // 六爻按钮配置
  sixYaoConfig: [
    { yinText: '初六', yangText: '初九', index: 0 },
    { yinText: '六二', yangText: '九二', index: 1 },
    { yinText: '六三', yangText: '九三', index: 2 },
    { yinText: '六四', yangText: '九四', index: 3 },
    { yinText: '六五', yangText: '九五', index: 4 },
    { yinText: '上六', yangText: '上九', index: 5 }
  ]
}
```

#### 2. 六爻变UI实现
```html
<!-- 六爻变模式内容 -->
<view wx:if="{{viewMode === 'sixYaoChange'}}" class="six-yao-view">
  <!-- 随机卦象卡片 -->
  <view class="random-card" 
        bindtouchstart="onTouchStart"
        bindtouchmove="onTouchMove"
        bindtouchend="onTouchEnd">
    <!-- 卦象序号 -->
    <view class="hexagram-sequence">第{{currentSixYaoHexagram.id}}卦</view>
    <!-- 卦象 -->
    <view class="hexagram-symbol-large">{{currentSixYaoHexagram.symbol}}</view>
    <!-- 卦名和拼音 -->
    <view class="hexagram-name-row">
      <view class="hexagram-name-large">{{currentSixYaoHexagram.name}}</view>
      <view class="hexagram-pinyin-large">{{currentSixYaoHexagram.pinyin}}</view>
    </view>
    <!-- 别名和上下卦 -->
    <view class="hexagram-extra-info">
      <view class="hexagram-alias">{{currentSixYaoHexagram.alias}}</view>
      <view class="hexagram-trigrams">上{{currentSixYaoHexagram.upperTrigram}}下{{currentSixYaoHexagram.lowerTrigram}}</view>
    </view>
    <!-- 卦辞 -->
    <view class="hexagram-text-section">
      <text class="section-title">卦辞</text>
      <text class="hexagram-text">{{currentSixYaoHexagram.hexagramText}}</text>
    </view>
  </view>
  
  <!-- 六爻按钮 -->
  <view class="six-yao-buttons">
    <view 
      class="yao-button {{sixYaoStates[item.index] ? 'yang' : 'yin'}}" 
      wx:for="{{sixYaoButtons}}" 
      wx:key="index"
      data-index="{{item.index}}"
      bindtap="onYaoButtonTap">
      <text class="yao-text">{{item.text}}</text>
      <text class="yao-symbol">{{item.symbol}}</text>
    </view>
  </view>
</view>
```

#### 3. 六爻状态管理函数
```javascript
// 生成六爻按钮配置
generateSixYaoButtons(yaoStates) {
  return this.data.sixYaoConfig.map((config, index) => {
    const isYang = yaoStates[index] === 1;
    return {
      index: index,
      text: isYang ? config.yangText : config.yinText,
      symbol: isYang ? '⚊' : '⚋'
    };
  });
}

// 从卦象符号提取六爻状态
extractYaoStatesFromSymbol(symbol) {
  // 将卦象符号转换为六爻状态数组
  // ... 实现转换逻辑 ...
  return [0, 0, 0, 0, 0, 0]; // 默认值
}

// 根据六爻状态找到对应的卦象
findHexagramByYaoStates(yaoStates) {
  // 遍历hexagramsData，找到匹配的卦象
  return hexagramsData.find(hexagram => {
    const states = this.extractYaoStatesFromSymbol(hexagram.symbol);
    return states.toString() === yaoStates.toString();
  });
}
```

#### 4. 事件处理函数
```javascript
// 切换到六爻变模式
switchToSixYaoChange() {
  // 初始化随机卦象
  const randomIndex = Math.floor(Math.random() * hexagramsData.length);
  const hexagram = hexagramsData[randomIndex];
  const yaoStates = this.extractYaoStatesFromSymbol(hexagram.symbol);
  
  this.setData({
    viewMode: 'sixYaoChange',
    currentSixYaoHexagram: hexagram,
    sixYaoStates: yaoStates,
    sixYaoButtons: this.generateSixYaoButtons(yaoStates)
  });
}

// 六爻按钮点击事件
onYaoButtonTap(e) {
  const index = e.currentTarget.dataset.index;
  const newYaoStates = [...this.data.sixYaoStates];
  newYaoStates[index] = newYaoStates[index] === 0 ? 1 : 0; // 切换阴阳状态
  
  // 根据新的六爻状态找到对应的卦象
  const hexagram = this.findHexagramByYaoStates(newYaoStates);
  
  this.setData({
    sixYaoStates: newYaoStates,
    currentSixYaoHexagram: hexagram,
    sixYaoButtons: this.generateSixYaoButtons(newYaoStates)
  });
}
```

#### 5. 滑动换页功能
```javascript
// 触摸结束事件扩展
onTouchEnd() {
  const { startX, moveX, viewMode } = this.data;
  const deltaX = moveX - startX;
  
  if (Math.abs(deltaX) > 50) {
    if (viewMode === 'random') {
      // 随机翻模式的滑动逻辑
      // ... 现有代码 ...
    } else if (viewMode === 'sixYaoChange') {
      // 六爻变模式的滑动逻辑
      let newHexagram;
      if (deltaX > 0) {
        // 向右滑动，上一个卦象
        const currentIndex = hexagramsData.findIndex(h => h.id === this.data.currentSixYaoHexagram.id);
        const newIndex = (currentIndex - 1 + hexagramsData.length) % hexagramsData.length;
        newHexagram = hexagramsData[newIndex];
      } else {
        // 向左滑动，下一个卦象
        const currentIndex = hexagramsData.findIndex(h => h.id === this.data.currentSixYaoHexagram.id);
        const newIndex = (currentIndex + 1) % hexagramsData.length;
        newHexagram = hexagramsData[newIndex];
      }
      
      // 更新六爻状态
      const yaoStates = this.extractYaoStatesFromSymbol(newHexagram.symbol);
      this.setData({
        currentSixYaoHexagram: newHexagram,
        sixYaoStates: yaoStates,
        sixYaoButtons: this.generateSixYaoButtons(yaoStates)
      });
    }
  }
}
```

### 预期效果
- 用户可在三种模式间自由切换
- 六爻变模式下，卦象显示清晰，六爻按钮符合周易规则
- 点击爻按钮可切换阴阳状态，卦象实时更新
- 左右滑动可换页，六爻状态同步更新
- 保持与原有功能的兼容性

### 测试要点
- 模式切换功能正常
- 六爻按钮显示符合周易规则
- 点击按钮切换阴阳状态，卦象同步更新
- 左右滑动换页功能正常，六爻状态同步更新
- 各模式下的UI显示正常
- 不同卦象下的六爻状态转换正确