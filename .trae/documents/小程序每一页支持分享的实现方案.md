# 小程序每一页支持分享的实现方案

## 1. 微信小程序分享机制概述

微信小程序分享主要通过两个生命周期函数实现：

* `onShareAppMessage`：用于分享给朋友

* `onShareTimeline`：用于分享到朋友圈

每个页面需要单独实现这两个函数，返回包含分享信息的对象（如标题、路径、图片等）。

## 2. 项目页面结构分析

项目包含多个页面，主要分为：

* 主页面：`pages/index/index`、`pages/about/about`、`pages/game/game`

* 子游戏页面：

  * `subgames/64Hexagrams/pages/hexagram-list/hexagram-list`

  * `subgames/64Hexagrams/pages/hexagram-detail/hexagram-detail`

  * `subgames/28Stars/pages/constellation-map/constellation-map`

  * `subgames/28Stars/pages/star-matching/star-matching`

  * 其他子游戏页面（28Stars、72DreamlandPoetryTravel、VegetableRootSayings、WuxingMysteries、family、future）

## 3. 实现方案

### 3.1 步骤一：识别所有需要添加分享功能的页面

使用 Glob 工具查找所有页面 JavaScript 文件：

```bash
glob **/pages/**/*.js **/subgames/**/pages/**/*.js
```

### 3.2 步骤二：为每个页面添加分享函数

为每个页面的 JavaScript 文件添加以下两个分享函数：

#### 3.2.1 onShareAppMessage 函数

```javascript
onShareAppMessage(options) {
  // 自定义分享标题、路径和图片
  return {
    title: '分享标题',
    path: '/pages/index/index', // 分享路径，带必要参数
    imageUrl: '/images/share-cover.png' // 分享封面图
  };
}
```

#### 3.2.2 onShareTimeline 函数

```javascript
onShareTimeline() {
  // 自定义分享到朋友圈的标题、查询参数和图片
  return {
    title: '分享到朋友圈标题',
    query: 'key=value', // 分享路径参数
    imageUrl: '/images/share-cover.png' // 分享封面图
  };
}
```

### 3.3 步骤三：定制各页面的分享内容

根据页面类型定制不同的分享内容：

#### 主页面

* **首页 (`pages/index/index`)**：

  * 分享标题："文益互动，探索中国传统文化的魅力"

  * 路径：`/pages/index/index`

* **关于页 (`pages/about/about`)**：

  * 分享标题："文益互动，了解中国传统文化小程序"

  * 路径：`/pages/about/about`

#### 六十四卦学习页面

* **卦象列表页 (`subgames/64Hexagrams/pages/hexagram-list/hexagram-list`)**：

  * 分享标题："学习易经六十四卦"

  * 路径：`/subgames/64Hexagrams/pages/hexagram-list/hexagram-list`

* **卦象详情页 (`subgames/64Hexagrams/pages/hexagram-detail/hexagram-detail`)**：

  * 分享标题：`{{currentHexagram.name}} - 易经六十四卦`

  * 路径：`/subgames/64Hexagrams/pages/hexagram-detail/hexagram-detail?hexagramId={{hexagramId}}`

#### 其他子游戏页面

类似地，为其他子游戏页面定制相应的分享内容。

### 3.4 步骤四：添加分享封面图

在项目中添加一张通用的分享封面图，放在 `/images/share-cover.png` 位置。

### 3.5 步骤五：测试分享功能

使用微信开发者工具测试每个页面的分享功能：

1. 进入每个页面
2. 点击右上角的分享按钮
3. 检查分享信息是否正确
4. 测试分享到朋友和朋友圈

## 4. 注意事项

1. **动态分享内容**：对于包含动态内容的页面（如卦象详情页），分享内容应反映当前页面状态
2. **分享路径**：确保分享路径包含必要参数，以便用户打开分享链接时显示正确内容
3. **封面图**：分享封面图尺寸建议为 5:4，最大不超过 128KB
4. **兼容性**：`onShareTimeline` 仅支持微信 7.0.12 及以上版本
5. **测试环境**：分享功能需要在真机上测试，开发者工具可能无法完全模拟

## 5. 预期效果

实现后，用户可以在小程序的任何页面点击右上角的分享按钮，将当前页面分享给朋友或分享到朋友圈，分享内容与页面内容相关。
