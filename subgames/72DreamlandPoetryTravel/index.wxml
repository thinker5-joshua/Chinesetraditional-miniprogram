<!-- æ˜Ÿç©ºèƒŒæ™¯ -->
<view id="stars" wx:if="{{showStars}}"></view>

<!-- æ¸¸æˆå®¹å™¨ -->
<view id="game-container">
  <!-- æ ‡é¢˜åŒºåŸŸ -->
<view class="game-header">
  <view class="title-glow-container">
    <text class="game-title">ä¸ƒåäºŒå¹»å¢ƒè¯—æ„æ—…è¡Œ</text>
  </view>
  <view class="game-subtitle">ç©¿è¶Šè¯—è¯<br/>æ¢ç´¢ä¸­å›½æœ€ç¾çš„72å¤„èƒœåœ°</view>
</view>

  <!-- ä¸»è¦æ¸¸æˆåŒºåŸŸ -->
<view id="game-main">
  <!-- ä»™ç•Œåœ°å›¾é€‰æ‹©ç•Œé¢ -->
<view id="compass-view" class="game-view {{currentView === 'compass' ? 'active' : ''}}">
  <!-- ä»™ç•Œåœ°å›¾å®¹å™¨ -->
<view class="immortal-map-container" style="position: relative; display: block; opacity: 1; visibility: visible;">
<view class="immortal-map" style="position: relative; display: block; opacity: 1; visibility: visible;">
  <!-- æ´å¤©ä½“å®¹å™¨ -->
<view id="caves-container" style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; display: block; visibility: visible; z-index: 1000;">
  <!-- æ´å¤©ä½“ -->
  <view wx:for="{{displayedCaves}}" wx:key="id" 
    class="cave-item" 
    style="left: {{item.x}}%; top: {{item.y}}%; background-color: {{item.color}}; animation-delay: {{item.animationDelay}}; z-index: {{item.zIndex}};"
    bindtap="selectCave" 
    data-cave-id="{{item.id}}">
    {{item.name}}
  </view>
</view>



<!-- ä»™ç•Œä»»æ„é—¨ -->
<button id="start-map" class="btn-primary fairy-door" style="position: absolute; bottom: 15%; left: 50%; transform: translateX(-50%); z-index: 1001;" bindtap="startMapClick">ä»™ç•Œä»»æ„é—¨</button>
</view>
</view>
</view>

  <!-- è¯—è¯æŒ‘æˆ˜ç•Œé¢ -->
<view id="poetry-challenge-view" class="game-view {{currentView === 'poetry-challenge' ? 'active' : ''}}">
<view class="challenge-container">
  <!-- æ´å¤©åç§°å¤§å­—æ˜¾ç¤º -->
  <view class="cave-name-big">
    <text>{{currentCave.name}}</text>
  </view>
  
  <!-- æ´å¤©æç¤º -->
<view class="cave-prompt">
  <text>{{cavePromptText}}</text>
</view>

<view class="poem-content-container">
<view id="poem-question" class="poem-display">
  <text class="poem-title">{{currentPoem.title}}</text>
  <view class="poet-info">
    <text>{{currentPoem.author}}</text>
  </view>
  <view class="poem-content-traditional">
    <block wx:for="{{currentPoemLines}}" wx:key="index">
      <rich-text class="poem-line" nodes="{{item}}"></rich-text>
    </block>
  </view>
</view>

<view class="challenge-section">
  <view class="word-challenge">
    <text class="challenge-hint">è¯·é€‰æ‹©ç¼ºå¤±çš„å­—</text>
    <view id="answer-options" class="options-container-horizontal">
      <button wx:for="{{answerOptions}}" wx:key="id" 
        class="option-btn-horizontal"
        bindtap="selectAnswer" 
        data-index="{{index}}">
        {{item.char}}
      </button>
    </view>
  </view>
</view>
</view>
</view>
</view>

  <!-- ç½—ç›˜è§†å›¾å·²æ•´åˆåˆ°compass-viewä¸­ -->

  <!-- æ´å¤©å±•ç¤ºç•Œé¢ -->
<view id="cave-view" class="game-view {{currentView === 'cave' ? 'active' : ''}}">
<view class="cave-container">
  <!-- æ´å¤©ä¿¡æ¯åŒºåŸŸ -->
<view class="cave-info-container">
  <!-- æ ‡é¢˜åŒºåŸŸ -->
  <view class="cave-title-section">
    <view class="cave-name-wrapper">
      <text class="cave-name">{{currentCave.name}}</text>
      <text class="cave-location">{{currentCave.location}}</text>
    </view>
  </view>

  <!-- ä¸»è¦å†…å®¹åŒºåŸŸ - å•åˆ—å¸ƒå±€ -->
  <view class="cave-content-single">
    <!-- ç¬¬ä¸€éƒ¨åˆ†ï¼šæ´å¤©ç®€ä»‹ -->
    <view class="cave-section modern-section">
      <view class="section-header">
        <text class="section-title">ğŸ›ï¸ æ´å¤©ç®€ä»‹</text>
      </view>
      <text class="cave-description">{{currentCave.description}}</text>
    </view>

    <!-- ç¬¬äºŒéƒ¨åˆ†ï¼šç›¸å…³è¯—è¯ -->
    <view class="cave-section modern-section poem-section">
      <view class="section-header">
        <text class="section-title">ğŸ“œ ç›¸å…³è¯—è¯</text>
      </view>
      
      <!-- è¯—è¯æ ‡é¢˜ä¿¡æ¯ -->
      <view class="poem-title-area">
        <text class="poem-title">{{currentCavePoem.title}}</text>
        <text class="poem-author">â€”â€” {{currentCavePoem.author}}</text>
      </view>

      <!-- è¯—è¯æ­£æ–‡ - ä¼ ç»Ÿåˆ†è¡Œæ’ç‰ˆ -->
      <view class="poem-content-traditional">
        <block wx:for="{{poemLines}}" wx:key="index">
          <text class="poem-line">{{item}}</text>
        </block>
      </view>

      <!-- è¯—è¯è¯´æ˜å’Œæ“ä½œ -->
      <view class="poem-actions">
        <text class="poem-explanation">{{currentCavePoem.connection_reason}}</text>
        <button class="poem-nav-btn" bindtap="nextPoem">ä¸‹ä¸€é¦– â¤</button>
      </view>
    </view>

    <!-- ç¬¬ä¸‰éƒ¨åˆ†ï¼šæ´å¤©åœ°å›¾ -->
    <view class="cave-section modern-section">
      <view class="section-header">
        <text class="section-title">ğŸ—ºï¸ æ´å¤©åœ°å›¾</text>
      </view>
      <view class="cave-map-wrapper">
        <map class="cave-map" 
          longitude="{{currentCave.longitude || 116.4074}}" 
          latitude="{{currentCave.latitude || 39.9042}}"
          scale="8"
          markers="{{mapMarkers}}"
          bindmarkertap="onMarkerTap">
        </map>
      </view>
    </view>
  </view>

  <!-- åº•éƒ¨æ“ä½œåŒº -->
  <view class="cave-actions">
    <button class="action-btn primary" bindtap="nextDreamland">
      <text class="action-icon">ğŸŒŸ</text>
      <text>æ¢ç´¢ä¸‹ä¸€å¹»å¢ƒ</text>
    </button>
  </view>
</view>
</view>
</view>
</view>
</view>

<!-- æ¸¸æˆé¡µè„š -->
<view class="game-footer">
  <text>Â© 2023 ä¸ƒåäºŒå¹»å¢ƒè¯—æ„æ—…è¡Œ | åŸºäºä¸­å›½ä¼ ç»Ÿè¯—è¯æ–‡åŒ–ä¸æ—…æ¸¸èƒœåœ°</text>
</view>

<!-- æˆåŠŸæç¤ºå¼¹çª— -->
<view id="success-modal" class="modal {{showSuccessModal ? 'show' : ''}}">
<view class="modal-content">
  <text class="modal-title">æ­å–œï¼</text>
  <text class="modal-message">æ‚¨å·²æˆåŠŸé€šè¿‡è¯—è¯æŒ‘æˆ˜ï¼Œå¯ä»¥è¿›å…¥æ´å¤©æ¬£èµç¾æ™¯äº†ã€‚</text>
  <button id="enter-cave" class="btn-primary" bindtap="enterCave">è¿›å…¥æ´å¤©</button>
</view>
</view>

<!-- é”™è¯¯æç¤ºå¼¹çª— -->
<view id="error-modal" class="modal {{showErrorModal ? 'show' : ''}}">
<view class="modal-content">
  <text class="modal-title">ç­”é¢˜æœ‰è¯¯</text>
  <text class="modal-message">è¯·å†ä»”ç»†æ€è€ƒä¸€ä¸‹ï¼Œæˆ–è€…ç‚¹å‡»æç¤ºæŒ‰é’®è·å–å¸®åŠ©ã€‚</text>
  <button id="close-error" class="btn-primary" bindtap="closeErrorModal">ç»§ç»­ç­”é¢˜</button>
</view>
</view>